@model IEnumerable<QuanLyGameConsole.Models.ViewModels.FavoriteVM>
@using System.Globalization
@using QuanLyGameConsole.Models.ViewModels
@{
    ViewData["Title"] = "Yêu thích";
}
    <!-- ...:::: Start Breadcrumb Section:::... -->
<div class="breadcrumb-section breadcrumb-bg-color--golden">
    <div class="breadcrumb-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h3 class="breadcrumb-title">Yêu Thích</h3>
                    <div class="breadcrumb-nav breadcrumb-nav-color--black breadcrumb-nav-hover-color--golden">
                        <nav aria-label="breadcrumb">
                            <ul>
                                <li><a asp-controller="Home" asp-action="index">Trang Chủ</a></li>
                                <li class="active" aria-current="page">Yêu Thích</li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- ...:::: End Breadcrumb Section:::... -->
<!-- ...:::: Start Wishlist Section:::... -->
<div class="wishlist-section">
    <!-- Start Cart Table -->
    <div class="wishlish-table-wrapper" data-aos="fade-up" data-aos-delay="0">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="table_desc">
                        <div class="table_page table-responsive">
                            <table>
                                <!-- Start Wishlist Table Head -->
                                <thead>
                                    <tr>
                                        <th class="product_thumb">Hình ảnh</th>
                                        <th class="product_name">Sản phẩm</th>
                                        <th class="product-price">Giá</th>
                                        <th class="product_addcart"></th>
                                        <th class="product_remove"></th>

                                    </tr>
                                </thead> <!-- End Cart Table Head -->
                                <tbody>
                                    <!-- Start Wishlist Single Item-->
                                    @foreach (var item in Model)
                                    {
                                        <tr id="favorite-item-@item.ProductId">

                                            <td class="product_thumb">
                                                <a href="#">
                                                    <img src="~/images/@(item.Image ?? "default-image.png")" alt="@item.Name" />
                                                </a>
                                            </td>
                                            <td class="product_name">
                                                <a href="#">
                                                    @item.Name
                                                </a>
                                            </td>
                                            <td class="product-price"> @String.Format(new CultureInfo("vi-VN"), "{0:C}",item.Price)</td>
                                            <td class="product_addcart">
                                                <div class="product-action-icon-link-list">
                                                    <a id="add-to-cart" data-slug="@item.Slug" data-quantity="1" class="btn btn-lg btn-black-default-hover add-to-cart">
                                                        Thêm vào giỏ
                                                    </a>
                                                </div>
                                            </td>
                                            <td class="product_remove">
                                                <a href="#" class="remove-favorite-btn" data-productid="@item.ProductId">
                                                    <i class="fa fa-trash-o"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End Cart Table -->
</div> <!-- ...:::: End Wishlist Section:::... -->
@section Scripts
{
    <!-- Mã JavaScript cho việc thêm vào giỏ hàng của bạn đã có ở đây... -->
    <script>
        $(document).ready(function () {

            // ===== ĐOẠN MÃ CHO NÚT THÊM VÀO GIỎ HÀNG (GIỮ NGUYÊN) =====
            $('.add-to-cart').click(function (e) {
                // ... mã của bạn
            });

            // ===== THÊM ĐOẠN MÃ MỚI NÀY CHO NÚT XÓA YÊU THÍCH =====
            $('.remove-favorite-btn').click(function (e) {
                e.preventDefault(); // Ngăn trang tải lại

                var productId = $(this).data('productid');
                var button = $(this); // Lưu lại nút đã nhấn

                $.ajax({
                    url: '@Url.Action("RemoveFavorite", "Account")', // Gọi đến action vừa tạo
                    type: 'POST',
                    data: { productId: productId },
                    success: function (result) {
                        if (result.success) {
                            // Xóa dòng sản phẩm khỏi bảng
                            $('#favorite-item-' + productId).fadeOut(300, function() { $(this).remove(); });

                            // Hiển thị thông báo thành công
                            Toastify({
                                text: result.message,
                                duration: 3000,
                                close: true,
                                gravity: "top",
                                position: "right",
                                style: { background: "#5cb85c" }
                            }).showToast();
                        } else {
                            // Hiển thị thông báo lỗi
                            Toastify({
                                text: result.message,
                                duration: 2000,
                                close: true,
                                gravity: "top",
                                position: "right",
                                style: { background: "#FF0000" }
                            }).showToast();
                        }
                    },
                    error: function () {
                        // Hiển thị thông báo khi có lỗi kết nối
                        Toastify({
                            text: 'Có lỗi xảy ra, vui lòng thử lại.',
                            duration: 2000,
                            close: true,
                            gravity: "top",
                            position: "right",
                            style: { background: "#FF0000" }
                        }).showToast();
                    }
                });
            });

        });
    </script>
}